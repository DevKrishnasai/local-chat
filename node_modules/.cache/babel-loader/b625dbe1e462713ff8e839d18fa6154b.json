{"ast":null,"code":"var _jsxFileName = \"E:\\\\Projects\\\\React Projects\\\\chat-app-firestore\\\\src\\\\components\\\\Search.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useState } from \"react\";\nimport debounce from \"lodash/debounce\";\nimport { collection, query, where, getDocs, setDoc, doc, updateDoc, serverTimestamp, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport { AuthContext } from \"../context/AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Search = () => {\n  _s();\n\n  const [username, setUsername] = useState(\"\");\n  const [searchResults, setSearchResults] = useState([]);\n  const [err, setErr] = useState(false);\n  const [load, setLoad] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const debouncedSearch = debounce(async searchText => {\n    const q = query(collection(db, \"users\"), where(\"displayName\", \"==\", searchText));\n\n    try {\n      const querySnapshot = await getDocs(q);\n      const results = querySnapshot.docs.map(doc => doc.data());\n      setSearchResults(results);\n      setErr(false);\n    } catch (err) {\n      setSearchResults([]);\n      setErr(true);\n    }\n\n    setLoad(false);\n  }, 300);\n\n  const handleSearch = searchText => {\n    if (searchText.trim() === \"\") {\n      setSearchResults([]);\n      setLoad(false);\n      return;\n    }\n\n    setLoad(true);\n    debouncedSearch(searchText);\n  };\n\n  const handleSelect = async selectedUser => {\n    const combinedId = currentUser.uid > selectedUser.uid ? currentUser.uid + selectedUser.uid : selectedUser.uid + currentUser.uid;\n\n    try {\n      const res = await getDoc(doc(db, \"chats\", combinedId));\n\n      if (!res.exists()) {\n        await setDoc(doc(db, \"chats\", combinedId), {\n          messages: []\n        });\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: selectedUser.uid,\n            displayName: selectedUser.displayName,\n            photoURL: selectedUser.photoURL\n          },\n          [combinedId + \".date\"]: serverTimestamp()\n        });\n        await updateDoc(doc(db, \"userChats\", selectedUser.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          },\n          [combinedId + \".date\"]: serverTimestamp()\n        });\n      }\n    } catch (err) {\n      setErr(true);\n    }\n\n    setSearchResults([]);\n    setUsername(\"\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"searchForm\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Find a user......\",\n        onChange: e => {\n          setUsername(e.target.value);\n          handleSearch(e.target.value);\n        },\n        value: username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: load && /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: \"white\"\n        },\n        children: \"Loading... \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 19\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), err && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: \"white\",\n        marginLeft: \"5px\"\n      },\n      children: \"User not found!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }, this), searchResults.length === 0 && !load && !err && username.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: \"white\"\n      },\n      children: \"No users found.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }, this), searchResults.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"searchResults\",\n      children: searchResults.map(result => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChat\",\n        onClick: () => handleSelect(result),\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: result.photoURL,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"userChatInfo\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: result.displayName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 15\n        }, this)]\n      }, result.uid, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Search, \"EFbuxv8ZDMzx0IMnIa3LXhzA6bE=\");\n\n_c = Search;\nexport default Search;\n\nvar _c;\n\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"sources":["E:/Projects/React Projects/chat-app-firestore/src/components/Search.jsx"],"names":["React","useContext","useState","debounce","collection","query","where","getDocs","setDoc","doc","updateDoc","serverTimestamp","getDoc","db","AuthContext","Search","username","setUsername","searchResults","setSearchResults","err","setErr","load","setLoad","currentUser","debouncedSearch","searchText","q","querySnapshot","results","docs","map","data","handleSearch","trim","handleSelect","selectedUser","combinedId","uid","res","exists","messages","displayName","photoURL","e","target","value","color","marginLeft","length","result"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport debounce from \"lodash/debounce\";\nimport {\n  collection,\n  query,\n  where,\n  getDocs,\n  setDoc,\n  doc,\n  updateDoc,\n  serverTimestamp,\n  getDoc,\n} from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport { AuthContext } from \"../context/AuthContext\";\n\nconst Search = () => {\n  const [username, setUsername] = useState(\"\");\n  const [searchResults, setSearchResults] = useState([]);\n  const [err, setErr] = useState(false);\n  const [load, setLoad] = useState(false);\n\n  const { currentUser } = useContext(AuthContext);\n\n  const debouncedSearch = debounce(async (searchText) => {\n    const q = query(\n      collection(db, \"users\"),\n      where(\"displayName\", \"==\", searchText)\n    );\n\n    try {\n      const querySnapshot = await getDocs(q);\n      const results = querySnapshot.docs.map((doc) => doc.data());\n      setSearchResults(results);\n      setErr(false);\n    } catch (err) {\n      setSearchResults([]);\n      setErr(true);\n    }\n    setLoad(false);\n  }, 300);\n\n  const handleSearch = (searchText) => {\n    if (searchText.trim() === \"\") {\n      setSearchResults([]);\n      setLoad(false);\n      return;\n    }\n    setLoad(true);\n    debouncedSearch(searchText);\n  };\n\n  const handleSelect = async (selectedUser) => {\n    const combinedId =\n      currentUser.uid > selectedUser.uid\n        ? currentUser.uid + selectedUser.uid\n        : selectedUser.uid + currentUser.uid;\n\n    try {\n      const res = await getDoc(doc(db, \"chats\", combinedId));\n\n      if (!res.exists()) {\n        await setDoc(doc(db, \"chats\", combinedId), { messages: [] });\n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: selectedUser.uid,\n            displayName: selectedUser.displayName,\n            photoURL: selectedUser.photoURL,\n          },\n          [combinedId + \".date\"]: serverTimestamp(),\n        });\n\n        await updateDoc(doc(db, \"userChats\", selectedUser.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL,\n          },\n          [combinedId + \".date\"]: serverTimestamp(),\n        });\n      }\n    } catch (err) {\n      setErr(true);\n    }\n\n    setSearchResults([]);\n    setUsername(\"\");\n  };\n\n  return (\n    <div className=\"search\">\n      <div className=\"searchForm\">\n        <input\n          type=\"text\"\n          placeholder=\"Find a user......\"\n          onChange={(e) => {\n            setUsername(e.target.value);\n            handleSearch(e.target.value);\n          }}\n          value={username}\n        />\n      </div>\n      <p>{load && <span style={{ color: \"white\" }}>Loading... </span>}</p>\n      {err && (\n        <p style={{ color: \"white\", marginLeft: \"5px\" }}>User not found!</p>\n      )}\n      {searchResults.length === 0 && !load && !err && username.length > 0 && (\n        <p style={{ color: \"white\" }}>No users found.</p>\n      )}\n      {searchResults.length > 0 && (\n        <div className=\"searchResults\">\n          {searchResults.map((result) => (\n            <div\n              key={result.uid}\n              className=\"userChat\"\n              onClick={() => handleSelect(result)}\n            >\n              <img src={result.photoURL} alt=\"\" />\n              <div className=\"userChatInfo\">\n                <span>{result.displayName}</span>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}